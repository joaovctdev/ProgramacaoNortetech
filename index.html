<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Programação de Obras Norte Tech</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
      :root {
        --primary-color: #1e90ff;
        --secondary-color: #0e1117;
        --accent-color: #ff6b6b;
        --text-color: #f0f6fc;
        --table-header: #161b22;
        --table-row: #21262d;
        --table-alt-row: #242c37;
        --filter-bg: #161b22;
        --border-color: #30363d;
        --sidebar-bg: #0a0d14;
        --sidebar-width: 280px;
        --primarycolormariua:#159398;
        --secondarycolormariua: #f4783b;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background-color: var(--secondary-color);
        color: var(--text-color);
        line-height: 1.6;
        padding: 0;
        display: flex;
        min-height: 100vh;
      }

      /* Sidebar estilo DeepSeek */
      .sidebar {
        width: var(--sidebar-width);
        background-color: var(--sidebar-bg);
        height: 100vh;
        position: fixed;
        left: 0;
        top: 0;
        padding: 20px 0;
        display: flex;
        flex-direction: column;
        z-index: 1000;
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.2);
        overflow-y: auto;
      }
      .sidebar-toggle {
        position: absolute;
        top: 20px;
        right: 10px;
        background: transparent;
        border: none;
        color: #64ffda;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
        transition: all 0.3s;
      }
      .sidebar-toggle:hover {
        background: rgba(100, 255, 218, 0.1);
      }
      /* Estilo para sidebar recolhida */
      .sidebar.collapsed {
        width: 70px;
      }
      .sidebar.collapsed ~ .main-content {
        margin-left: 70px;
        width: calc(100% - 70px);
      }
      .sidebar.collapsed .sidebar-title,
      .sidebar.collapsed .menu-text,
      .sidebar.collapsed .sidebar-footer {
        display: none;
      }

      .sidebar.collapsed .sidebar-header {
        padding: 15px 5px;
        text-align: center;
      }

      .sidebar.collapsed .sidebar-logo {
        max-width: 40px;
        margin: 0 auto;
      }

      .sidebar.collapsed .menu-item {
        justify-content: center;
        padding: 12px 5px;
      }

      .sidebar.collapsed .menu-item i {
        margin-right: 0;
        font-size: 18px;
      }

      .sidebar.collapsed .sidebar-toggle i {
        transform: rotate(180deg);
      }

      /* Transição suave */
      .sidebar {
        transition: width 0.3s ease;
      }

      .sidebar-header {
        position: relative;
        transition: all 0.3s ease;
      }

      .sidebar-header {
        padding: 0 20px 20px;
        border-bottom: 1px solid var(--border-color);
        margin-bottom: 20px;
      }

      .sidebar-logo {
        width: 160px;
        height: auto;
        margin-bottom: -55px;
        margin-top: -91px;
      }

      .sidebar-title {
        font-size: 1.2rem;
        color: var(--primary-color);
        font-weight: bold;
      }

      .sidebar-menu {
        flex: 1;
      }

      .menu-item {
        padding: 15px 20px;
        display: flex;
        align-items: center;
        color: #e2c529;
        text-decoration: none;
        transition: all 0.3s;
        border-left: 4px solid transparent;
      }

      .menu-item:hover {
        background-color: rgba(30, 144, 255, 0.1);
        border-left-color: var(--primary-color);
      }

      .menu-item.active {
        background-color: rgba(30, 144, 255, 0.2);
        border-left-color: var(--primary-color);
        color: var(--primary-color);
      }

      .menu-item i {
        margin-right: 15px;
        font-size: 1.2rem;
        width: 24px;
        text-align: center;
      }

      .menu-text {
        flex: 1;
      }

      .sidebar-footer {
        padding: 20px;
        border-top: 1px solid var(--border-color);
        font-size: 0.9rem;
        color: #7f8c8d;
      }

      .main-content {
        flex: 1;
        margin-left: var(--sidebar-width);
        padding: 20px;
      }

      .container {
        max-width: 1400px;
        margin-left: 82px;
        zoom: 77%;
      }

      header {
        background: linear-gradient(135deg, #0e1117 0%, #1a1f29 100%);
        padding: 30px 0;
        text-align: center;
        margin-bottom: 30px;
        border-bottom: 2px solid var(--primary-color);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        position: relative;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 40px;
        border-radius: 10px;
      }

      .header-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        flex: 1;
        margin-left: 50px;
      }

      h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        margin-left: 117px;
        color: var(--primarycolormariua) ;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      .logo {
        width: 227px;
        height: 87px;
        margin-top: -17px;
        margin-bottom: 0px;
      }

      .subtitle {
        font-size: 1.1rem;
        opacity: 0.9;
        max-width: 800px;
        margin: 0;
        margin-left: 114px;
      }

      .current-date {
        font-size: 1.1rem;
        margin-top: 15px;
        color: var(--secondarycolormariua) ;
        font-weight: bold;
        margin-left: 108px;
      }
      .add-row-section {
        background-color: #1e2535;
        padding: 15px 20px;
        border-radius: 10px;
        margin-bottom: 20px;
      }

      .add-row-title {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 15px;
        color: #e2c529;
      }

      .horizontal-form {
        display: flex;
        flex-wrap: nowrap;
        gap: 10px;
        margin-bottom: 0;
        align-items: end;
        overflow-x: auto;
        padding-bottom: 5px;
      }

      .horizontal-form::-webkit-scrollbar {
        height: 5px;
      }

      .horizontal-form::-webkit-scrollbar-track {
        background: #0e1117;
        border-radius: 10px;
      }

      .horizontal-form::-webkit-scrollbar-thumb {
        background: #e2c529;
        border-radius: 10px;
      }

      .form-item {
        display: flex;
        flex-direction: column;
        flex: 0 0 auto;
        min-width: 100px;
      }

      .form-item label {
        margin-bottom: 5px;
        font-weight: bold;
        color: #8892b0;
        font-size: 12px;
        white-space: nowrap;
      }

      .form-item input,
      .form-item select {
        padding: 8px;
        border-radius: 5px;
        border: 1px solid #2a3245;
        background-color: #0e1117;
        color: white;
        font-size: 12px;
        min-width: 0;
      }

      .form-actions {
        display: flex;
        gap: 5px;
      }

      .form-actions button {
        padding: 8px 12px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s;
      }

      #add-row-btn {
        background-color: #e2c529;
        color: #0e1117;
      }

      #clear-form-btn {
        background-color: #e2c529;
        color: white;
      }

      /* Responsividade para dispositivos menores */
      @media (max-width: 1200px) {
        .form-item {
          min-width: 90px;
        }

        .form-item input,
        .form-item select {
          padding: 6px;
          font-size: 11px;
        }

        .form-actions button {
          padding: 6px 10px;
        }
      }
      .filters-section {
        background-color: var(--filter-bg);
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        border: 1px solid var(--border-color);
      }

      .filters-title {
        font-size: 1.3rem;
        margin-bottom: 15px;
        color: var(--primary-color);
        display: flex;
        align-items: center;
      }

      .filters-title i {
        margin-right: 10px;
      }

      .filter-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin-bottom: 15px;
      }

      .filter-item {
        display: flex;
        flex-direction: column;
      }

      label {
        font-weight: bold;
        margin-bottom: 8px;
        color: var(--text-color);
        font-size: 0.9rem;
      }

      select,
      input {
        padding: 12px;
        background-color: var(--table-row);
        color: var(--text-color);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        font-size: 1rem;
        transition: all 0.3s;
      }

      select:focus,
      input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 2px rgba(30, 144, 255, 0.2);
      }

      .filter-actions {
        display: flex;
        justify-content: flex-end;
        gap: 15px;
      }

      .export-buttons {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
        justify-content: flex-end;
      }

      button {
        background: linear-gradient(to right, var(--primary-color), #4a86e8);
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: bold;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      button i {
        margin-right: 8px;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      .export-btn.png {
        background: linear-gradient(to right, #27ae60, #2ecc71);
        padding: 9px;
        text-align: center;
      }

      .export-btn.jpeg {
        background: linear-gradient(to right, #3498db, #2980b9);
        opacity: 0;
        position: absolute;
        pointer-events: none;
      }

      #reset-filters {
        background: linear-gradient(to right, #e74c3c, #c0392b);
      }

      .table-container {
        background-color: var(--filter-bg);
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        margin-bottom: 30px;
        border: 1px solid var(--border-color);
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th,
      td {
        padding: 16px;
        text-align: left;
        border-bottom: 1px solid var(--border-color);
      }

      th {
        background-color: var(--table-header);
        color: var(--primary-color);
        position: sticky;
        top: 0;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.9rem;
      }

      tr {
        background-color: var(--table-row);
      }

      tr:nth-child(even) {
        background-color: var(--table-alt-row);
      }

      tr:hover {
        background-color: #2a3342;
      }

      .status-badge {
        display: inline-block;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: bold;
        text-align: center;
        min-width: 120px;
      }

      .status-active {
        background-color: var(--secondarycolormariua);
        color: white;
      }

      .status-pending {
        background-color: #0718ff;
        color: white;
      }

      .status-completed {
        background-color: #00ff15;
        color: white;
      }

      footer {
        text-align: center;
        margin-top: 40px;
        color: #7f8c8d;
        font-size: 0.9rem;
        padding: 20px;
        border-top: 1px solid var(--border-color);
      }

      .no-results {
        text-align: center;
        padding: 40px;
        color: #7f8c8d;
        font-size: 1.1rem;
      }

      .no-results i {
        font-size: 2rem;
        margin-bottom: 15px;
        color: var(--primary-color);
      }

      .loading {
        text-align: center;
        padding: 30px;
        color: var(--primary-color);
      }

      .menu-toggle {
        display: none;
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 1100;
        background: var(--primary-color);
        color: white;
        border: none;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        font-size: 1.5rem;
        cursor: pointer;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      }

      @media (max-width: 1024px) {
        .sidebar {
          transform: translateX(-100%);
          width: var(--sidebar-width);
        }

        .sidebar.expanded {
          transform: translateX(0);
        }

        .main-content {
          margin-left: 0;
        }

        .menu-toggle {
          display: block;
        }
      }

      @media (max-width: 768px) {
        th,
        td {
          padding: 12px 10px;
          font-size: 0.9rem;
        }

        h1 {
          font-size: 2rem;
        }

        header {
          flex-direction: column;
          text-align: center;
          padding: 20px;
        }

        .header-content {
          align-items: center;
          text-align: center;
          margin-bottom: 20px;
        }

        .export-buttons {
          flex-direction: column;
        }

        .filter-grid {
          grid-template-columns: 1fr;
        }

        .filter-actions {
          flex-direction: column;
        }
      }
      /* Estilos para o Quadro de Energização */
      .energizacao-section {
        background-color: #1e2535;
        padding: 20px;
        border-radius: 10px;
        margin: 30px auto;
        border: 1px solid #2a3245;
        max-width: 1121px;
        width: 95%;
      }

      .section-header {
        display: flex;
        justify-content: center; /* Centraliza o título */
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #e2c529;
        position: relative; /* Para posicionar o logo absolutamente */
      }

      .section-header h2 {
        color: #e2c529;
        font-size: 1.8rem;
        margin: 0;
        text-align: center;
      }

      /* Logo no header */
      .energizacao-logo {
        position: absolute;
        right: 0;
        width: 120px;
        height: auto;
      }

      .energizacao-container {
        background-color: #0e1117;
        padding: 20px;
        border-radius: 8px;
      }

      .energizacao-form {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .form-row {
        display: flex;
        gap: 15px;
      }

      .form-group {
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      .form-group.full-width {
        flex: 2;
      }

      .form-group label {
        font-weight: bold;
        margin-bottom: 8px;
        color: #8892b0;
        font-size: 14px;
      }

      .form-group input,
      .form-group textarea {
        padding: 12px;
        border: 1px solid #2a3245;
        border-radius: 5px;
        background-color: #1a1f29;
        color: white;
        font-size: 14px;
      }

      /* OBSERVAÇÃO - Agora na parte inferior */
      .observacao-container {
        margin-top: 20px;
        padding-top: 15px;
        border-top: 1px solid #2a3245;
      }

      .observacao-container label {
        font-weight: bold;
        display: block;
        margin-bottom: 8px;
        color: #8892b0;
        font-size: 14px;
      }

      .observacao-container textarea {
        width: 100%;
        min-height: 100px;
        padding: 12px;
        border: 1px solid #2a3245;
        border-radius: 5px;
        background-color: #1a1f29;
        color: white;
        font-size: 14px;
        resize: vertical;
      }

      .form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 15px;
        margin-top: 20px;
      }

      #salvar-energizacao {
        background: linear-gradient(to right, #27ae60, #2ecc71);
      }

      #limpar-energizacao {
        background: linear-gradient(to right, #e74c3c, #c0392b);
      }

      /* Responsividade */
      @media (max-width: 768px) {
        .form-row {
          flex-direction: column;
          gap: 10px;
        }

        .section-header {
          flex-direction: column;
          gap: 15px;
          text-align: center;
        }

        .energizacao-logo {
          position: relative;
          margin-top: 10px;
        }

        .form-actions {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <body>
      <button class="menu-toggle" id="menu-toggle">
        <i class="fas fa-bars"></i>
      </button>

      <main class="main-content">
        <div class="container">
          <header>
            <div class="header-content">
              <h1><i class="fas fa-hard-hat"></i> PROGRAMAÇÃO DE OBRAS</h1>
              <p class="subtitle">
                Controle e acompanhamento de Obras - Outubro
              </p>
              <div class="current-date" id="current-date">Data de hoje :</div>
            </div>
            <img src="Color logo - no background.png" alt="Norte Tech Logo" class="logo" />
          </header>

          <div class="export-buttons">
            <button id="export-png" class="export-btn png">
              <i class="fas fa-download"></i> Exportar PNG
            </button>
            <button id="export-jpeg" class="export-btn jpeg">
              <i class="fas fa-download"></i> Exportar JPEG
            </button>
            <button
              id="export-png-date"
              class="export-btn png-date"
              onclick="exportTableWithDates('png')"
            >
              <i class="fas fa-download"></i> Exportar PNG C/ Data
            </button>
          </div>

          <!-- SEÇÃO PARA ADICIONAR NOVAS LINHAS - FORMULÁRIO HORIZONTAL -->
          <section class="add-row-section">
            <div class="add-row-title">
              <i class="fas fa-plus-circle"></i> Adicionar Nova Obra
            </div>
            <div class="horizontal-form">
              <div class="form-item">
                <label for="new-obra">B-OBRA *</label>
                <input
                  type="text"
                  id="new-obra"
                  placeholder="B-OBRA"
                  title="Código da obra"
                />
              </div>
              <div class="form-item">
                <label for="new-encarregado">Encarregado</label>
                <input
                  type="text"
                  id="new-encarregado"
                  placeholder="Encarregado"
                  title="Nome do encarregado"
                />
              </div>
              <div class="form-item">
                <label for="new-supervisor">Supervisor</label>
                <input
                  type="text"
                  id="new-supervisor"
                  placeholder="Supervisor"
                  title="Nome do supervisor"
                />
              </div>
              <div class="form-item">
                <label for="new-titulo">Título</label>
                <input
                  type="text"
                  id="new-titulo"
                  placeholder="Título"
                  title="Título da obra"
                />
              </div>
              <div class="form-item">
                <label for="new-municipio">Município</label>
                <input
                  type="text"
                  id="new-municipio"
                  placeholder="Município"
                  title="Município"
                />
              </div>
              <div class="form-item">
                <label for="new-criterio">Critério</label>
                <input
                  type="text"
                  id="new-criterio"
                  placeholder="Critério"
                  title="Critério"
                />
              </div>
              <div class="form-item">
                <label for="new-atividade">Atividade</label>
                <input
                  type="text"
                  id="new-atividade"
                  placeholder="Atividade"
                  title="Atividade do dia"
                />
              </div>
              <div class="form-item">
                <label for="new-inicio">Início</label>
                <input type="date" id="new-inicio" title="Data de início" />
              </div>
              <div class="form-item">
                <label for="new-termino">Término</label>
                <input type="date" id="new-termino" title="Data de término" />
              </div>
              <div class="form-item">
                <label style="opacity: 0">Ações</label>
                <div class="form-actions">
                  <button id="add-row-btn" title="Adicionar obra">
                    <i class="fas fa-plus"></i>
                  </button>
                  <button id="clear-form-btn" title="Limpar formulário">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>
            </div>
          </section>

          <!-- SEÇÃO DE FILTROS -->
          <section class="filters-section">
            <div class="filters-title">
              <i class="fas fa-filter"></i> Filtros
            </div>
            <div class="filter-grid">
              <div class="filter-item">
                <label for="date-filter">Filtrar por data:</label>
                <select id="date-filter">
                  <option value="today">Obras de hoje</option>
                  <option value="tomorrow">Obras de amanhã</option>
                  <option value="week">Próximos 7 dias</option>
                  <option value="month">Próximos 30 dias</option>
                  <option value="all">Todas as obras</option>
                </select>
              </div>

              <div class="filter-item">
                <label for="supervisor-filter">Supervisor:</label>
                <select id="supervisor-filter">
                  <option value="all">Todos os supervisores</option>
                </select>
              </div>
              <div class="filter-item">
                <label for="encarregado-filter">Encarregado:</label>
                <select id="encarregado-filter">
                  <option value="all">Todos os encarregados</option>
                </select>
              </div>

              <div class="filter-item">
                <label for="municipio-filter">Município:</label>
                <select id="municipio-filter">
                  <option value="all">Todos os municípios</option>
                </select>
              </div>

              <div class="filter-item">
                <label for="search">Pesquisar:</label>
                <input
                  type="text"
                  id="search"
                  placeholder="Digite para buscar..."
                />
              </div>
            </div>
            <div class="filter-actions">
              <button id="apply-filters">
                <i class="fas fa-check"></i> Aplicar Filtros
              </button>
              <button id="reset-filters">
                <i class="fas fa-times"></i> Limpar Filtros
              </button>
            </div>
          </section>

          <section class="table-container" id="table-to-export">
            <table id="obras-table">
              <thead>
                <tr>
                  <th>Obra</th>
                  <th>Encarregado</th>
                  <th>Supervisor</th>
                  <th>Título</th>
                  <th>Município</th>
                  <th>Atividade do Dia</th>
                  <th>Critério</th>
                  <th>Início</th>
                  <th>Término</th>
                  <th>Status</th>
                  <th>Ações</th>
                </tr>
              </thead>
              <tbody id="table-body">
                <tr>
                  <td colspan="11">
                    <div class="loading">
                      <i class="fas fa-spinner fa-spin"></i> Carregando dados...
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
            <div class="no-results" id="no-results" style="display: none">
              <i class="fas fa-inbox"></i>
              <p>Nenhuma obra encontrada com os filtros aplicados.</p>
            </div>
          </section>
        </div>
        <!-- SEÇÃO DO QUADRO DE ENERGIZAÇÃO -->
        <!--   <section class="energizacao-section" id="quadro-energizacao"> -!>
          <div class="section-header">
            <h2><i class="fas fa-bolt"></i> QUADRO DE ENERGIZAÇÃO</h2>
            <img
              src="NorteTech.png"
              alt="Norte Tech Logo"
              class="energizacao-logo"
            />
          </div>

          <div class="data-selector">
            <label for="obra-select">Selecione a obra energizada: </label>
            <select id="obra-select">
              <option value="">Selecione uma obra</option>
               As opções serão preenchidas via JavaScript 
            </select>
          </div>

          <div id="notification" class="notification"></div>

          <div class="energizacao-container">
            <div class="energizacao-form">
              <div class="form-row">
                <div class="form-group">
                  <label for="energizacao-obra">Obra:</label>
                  <input
                    type="text"
                    id="energizacao-obra"
                    placeholder="MP-CCOL-POV. CHUVEIRO-RURAL"
                  />
                </div>
                <div class="form-group">
                  <label for="energizacao-projeto-obra">Projeto OBRA:</label>
                  <input
                    type="text"
                    id="energizacao-projeto-obra"
                    placeholder="B-1048584"
                  />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="energizacao-projeto-kit">Projeto KIT:</label>
                  <input
                    type="text"
                    id="energizacao-projeto-kit"
                    placeholder="X"
                  />
                </div>
                <div class="form-group">
                  <label for="energizacao-projeto-medidor"
                    >Projeto MEDIDOR:</label
                  >
                  <input
                    type="text"
                    id="energizacao-projeto-medidor"
                    placeholder="X"
                  />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="energizacao-municipio">Município:</label>
                  <input
                    type="text"
                    id="energizacao-municipio"
                    placeholder="X"
                  />
                </div>
                <div class="form-group">
                  <label for="energizacao-utd">UTD:</label>
                  <input type="text" id="energizacao-utd" placeholder="IRECÊ" />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="energizacao-plano">Plano:</label>
                  <input type="text" id="energizacao-plano" placeholder="X" />
                </div>
                <div class="form-group">
                  <label for="energizacao-criterio">Critério:</label>
                  <input
                    type="text"
                    id="energizacao-criterio"
                    placeholder="X"
                  />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="energizacao-fiscal">Fiscal / AR:</label>
                  <input type="text" id="energizacao-fiscal" placeholder="X" />
                </div>
                <div class="form-group">
                  <label for="energizacao-encarregado">Encarregado:</label>
                  <input
                    type="text"
                    id="energizacao-encarregado"
                    placeholder="X"
                  />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="energizacao-supervisor">Supervisor:</label>
                  <input
                    type="text"
                    id="energizacao-supervisor"
                    placeholder="X"
                  />
                </div>
                <div class="form-group">
                  <label for="energizacao-pes">PES:</label>
                  <input type="text" id="energizacao-pes" placeholder="X" />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="energizacao-oc">OC:</label>
                  <input type="text" id="energizacao-oc" placeholder="X" />
                </div>
                <div class="form-group">
                  <label for="energizacao-data-pms">Data da PMS:</label>
                  <input type="date" id="energizacao-data-pms" />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="energizacao-postes">Postes:</label>
                  <input
                    type="number"
                    id="energizacao-postes"
                    placeholder="X"
                  />
                </div>
                <div class="form-group">
                  <label for="energizacao-clientes">Clientes Ligados:</label>
                  <input
                    type="text"
                    id="energizacao-clientes"
                    placeholder="X"
                  />
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="energizacao-perdas">Perdas:</label>
                  <input
                    type="number"
                    id="energizacao-perdas"
                    placeholder="0"
                  />
                </div>
              </div>

               OBSERVAÇÃO - Agora na parte inferior, separada 
              <div class="observacao-container">
                <label for="energizacao-obs">OBSERVAÇÕES:</label>
                <textarea
                  id="energizacao-obs"
                  placeholder="Observações adicionais"
                ></textarea>
              </div>
            </div>

            <div class="form-actions">
              <button id="salvar-energizacao">
                <i class="fas fa-save"></i> Salvar Quadro
              </button>
              <button id="limpar-energizacao">
                <i class="fas fa-times"></i> Limpar
              </button>
              <button id="export-energizacao" class="export-btn png">
                <i class="fas fa-download"></i> Exportar Quadro
              </button>
            </div>
          </div>
        </section> -->
        <footer>
          <p>joaovctdev &copy; 2025 - Sistema de Gerenciamento de Obras</p>
        </footer>
      </main>

      <script>
        // Variáveis globais
        let obrasData = [];
        const today = new Date();

        // Formatar data para exibição
        function formatDate(dateString) {
          if (!dateString) return "-";

          // Formato DD/MM/YYYY para Date object
          const [day, month, year] = dateString.split("/");
          const date = new Date(year, month - 1, day);
          return date.toLocaleDateString("pt-BR");
        }

        // Converter string de data para objeto Date
        function parseDate(dateString) {
          if (!dateString) return null;

          const [day, month, year] = dateString.split("/");
          return new Date(year, month - 1, day);
        }

        // Calcular status com base nas datas - FUNÇÃO CORRIGIDA
        function getStatus(startDate, endDate) {
          // Se não tem uma das datas, retorna Pendente
          if (!startDate || !endDate) {
            return { status: "pending", text: "Pendente" };
          }

          const start = parseDate(startDate);
          const end = parseDate(endDate);

          // Se as datas são inválidas, retorna Pendente
          if (!start || !end) {
            return { status: "pending", text: "Pendente" };
          }

          // Resetar horas para comparar apenas as datas
          const today = new Date();
          today.setHours(0, 0, 0, 0);
          start.setHours(0, 0, 0, 0);
          end.setHours(0, 0, 0, 0);

          // CORREÇÃO DA LÓGICA:
          // - Se hoje é ANTES da data de início: Programada
          // - Se hoje é DEPOIS da data de término: Concluída
          // - Se hoje está ENTRE início e término: Em Andamento

          if (today < start) {
            return { status: "pending", text: "Programada" };
          } else if (today > end) {
            return { status: "completed", text: "Concluída" };
          } else {
            return { status: "active", text: "Em Andamento" };
          }
        }

        // Carregar dados do arquivo JSON
        async function loadData() {
          try {
            const response = await fetch("bd.json");
            obrasData = await response.json();

            // Garantir que cada item tenha um ID único
            obrasData.forEach((item, index) => {
              if (!item.id) {
                item.id = `obra-${index}-${Date.now()}`;
              }
            });

            renderTable(obrasData);
            populateFilters(obrasData);
            applyFilters();
          } catch (error) {
            console.error("Erro ao carregar os dados:", error);
            document.getElementById("table-body").innerHTML = `
                            <tr>
                                <td colspan="11">
                                    <div class="no-results">
                                        <i class="fas fa-exclamation-triangle"></i>
                                        <p>Erro ao carregar os dados. Verifique o arquivo bd.json.</p>
                                    </div>
                                </td>
                            </tr>
                        `;
          }
        }

        // Funções auxiliares para datas
        function formatDateForJSON(date) {
          const day = String(date.getDate()).padStart(2, "0");
          const month = String(date.getMonth() + 1).padStart(2, "0");
          const year = date.getFullYear();
          return `${day}/${month}/${year}`;
        }

        function getTomorrowDate() {
          const tomorrow = new Date();
          tomorrow.setDate(tomorrow.getDate() + 1);
          return tomorrow;
        }

        function getDateDaysFromToday(days) {
          const date = new Date();
          date.setDate(date.getDate() + days);
          return date;
        }

        // Popular os filtros com dados dinâmicos
        function populateFilters(data) {
          const supervisorFilter = document.getElementById("supervisor-filter");
          const encarregadoFilter =
            document.getElementById("encarregado-filter");
          const municipioFilter = document.getElementById("municipio-filter");

          const supervisors = [
            ...new Set(data.map((item) => item.B).filter(Boolean)),
          ];
          const municipios = [
            ...new Set(data.map((item) => item.E).filter(Boolean)),
          ];
          const encarregados = [
            ...new Set(data.map((item) => item.A).filter(Boolean)),
          ];

          supervisors.forEach((supervisor) => {
            const option = document.createElement("option");
            option.value = supervisor;
            option.textContent = supervisor;
            supervisorFilter.appendChild(option);
          });

          municipios.forEach((municipio) => {
            const option = document.createElement("option");
            option.value = municipio;
            option.textContent = municipio;
            municipioFilter.appendChild(option);
          });

          encarregados.forEach((encarregado) => {
            const option = document.createElement("option");
            option.value = encarregado;
            option.textContent = encarregado;
            encarregadoFilter.appendChild(option);
          });
        }

        // Função para preencher automaticamente os campos quando o código da obra é inserido
        function autoFillFromObraCode(obraCode) {
          if (!obraCode) return;

          const obraExistente = obrasData.find((item) => item.C === obraCode);

          if (obraExistente) {
            document.getElementById("new-titulo").value = obraExistente.D || "";
            document.getElementById("new-municipio").value =
              obraExistente.E || "";
            document.getElementById("new-criterio").value =
              obraExistente.F || "";

            if (obraExistente.I) {
              const [day, month, year] = obraExistente.I.split("/");
              document.getElementById(
                "new-inicio"
              ).value = `${year}-${month.padStart(2, "0")}-${day.padStart(
                2,
                "0"
              )}`;
            }

            if (obraExistente.J) {
              const [day, month, year] = obraExistente.J.split("/");
              document.getElementById(
                "new-termino"
              ).value = `${year}-${month.padStart(2, "0")}-${day.padStart(
                2,
                "0"
              )}`;
            }
          } else {
            document.getElementById("new-titulo").value = "";
            document.getElementById("new-municipio").value = "";
            document.getElementById("new-criterio").value = "";
          }
        }

        // Função para adicionar uma nova obra
        function addNewObra() {
          const obra = document.getElementById("new-obra").value;
          const encarregado = document.getElementById("new-encarregado").value;
          const supervisor = document.getElementById("new-supervisor").value;
          const titulo = document.getElementById("new-titulo").value;
          const municipio = document.getElementById("new-municipio").value;
          const criterio = document.getElementById("new-criterio").value;
          const atividade = document.getElementById("new-atividade").value;
          const inicio = document.getElementById("new-inicio").value;
          const termino = document.getElementById("new-termino").value;

          if (!obra) {
            alert("Por favor, informe o código da obra.");
            return;
          }

          const inicioFormatado = inicio ? formatDateFromInput(inicio) : "";
          const terminoFormatado = termino ? formatDateFromInput(termino) : "";

          const novaObra = {
            id: `obra-${Date.now()}`,
            C: obra,
            A: encarregado,
            B: supervisor,
            D: titulo,
            E: municipio,
            F: criterio,
            atividade: atividade,
            I: inicioFormatado, // Data de início
            J: terminoFormatado, // Data de término
          };

          obrasData.push(novaObra);
          renderTable(obrasData);
          clearForm();
          applyFilters();
          console.log("Nova obra adicionada:", novaObra);
        }

        // Função para formatar data do input (YYYY-MM-DD) para DD/MM/YYYY
        function formatDateFromInput(dateString) {
          if (!dateString) return "";
          const [year, month, day] = dateString.split("-");
          return `${day}/${month}/${year}`;
        }

        // Função para limpar o formulário
        function clearForm() {
          document.getElementById("new-obra").value = "";
          document.getElementById("new-encarregado").value = "";
          document.getElementById("new-supervisor").value = "";
          document.getElementById("new-titulo").value = "";
          document.getElementById("new-municipio").value = "";
          document.getElementById("new-criterio").value = "";
          document.getElementById("new-atividade").value = "";
          document.getElementById("new-inicio").value = "";
          document.getElementById("new-termino").value = "";
        }

        // Função para editar atividade
        function editActivity(index, obraId) {
          const activityCell = document.getElementById(
            `activity-cell-${index}`
          );
          const activityText = document.getElementById(
            `activity-text-${index}`
          );
          const currentActivity = activityText.textContent;

          activityCell.innerHTML = `
                        <input type="text" id="activity-input-${index}" class="activity-input" value="${currentActivity}" placeholder="">
                        <button onclick="saveActivity(${index}, '${obraId}')" class="activity-edit-btn"><i class="fas fa-check"></i></button>
                        <button onclick="cancelEdit(${index}, '${currentActivity}')" class="activity-edit-btn"><i class="fas fa-times"></i></button>
                    `;

          const inputElement = document.getElementById(
            `activity-input-${index}`
          );
          inputElement.focus();

          inputElement.addEventListener("input", function () {
            this.removeAttribute("placeholder");
          });
        }

        // Função para salvar atividade
        function saveActivity(index, obraId) {
          const newActivity = document.getElementById(
            `activity-input-${index}`
          ).value;

          const obraIndex = obrasData.findIndex((item) => item.id === obraId);
          if (obraIndex !== -1) {
            obrasData[obraIndex].atividade = newActivity;
          }

          updateActivityDisplay(index, obraId, newActivity, false);
          console.log(`Atividade salva para obra ${obraId}:`, newActivity);
        }

        // Função para cancelar edição
        function cancelEdit(index, originalActivity) {
          const obraId = obrasData[index].id;
          updateActivityDisplay(index, obraId, originalActivity, true);
        }

        // Atualizar a exibição da atividade
        function updateActivityDisplay(
          index,
          obraId,
          activity,
          showEditButton = true
        ) {
          const editButtonHtml = showEditButton
            ? `<button onclick="editActivity(${index}, '${obraId}')" class="activity-edit-btn">
                            <i class="fas fa-edit"></i>
                        </button>`
            : "";

          document.getElementById(`activity-cell-${index}`).innerHTML = `
                        <div class="activity-text" id="activity-text-${index}" onclick="editActivity(${index}, '${obraId}')">
                            ${
                              activity || '<div class="placeholder-text"></div>'
                            }
                        </div>
                        ${editButtonHtml}
                    `;
        }

        // Renderizar a tabela com os dados
        function renderTable(data) {
          const tableBody = document.getElementById("table-body");
          const noResults = document.getElementById("no-results");

          tableBody.innerHTML = "";

          if (data.length === 0) {
            noResults.style.display = "block";
            return;
          }

          noResults.style.display = "none";

          data.forEach((item, index) => {
            // CORREÇÃO: Passar I (início) e J (término) corretamente para getStatus
            const status = getStatus(item.I, item.J);

            const row = document.createElement("tr");
            row.innerHTML = `
                            <td>${item.C || "-"}</td>
                            <td>${item.A || "-"}</td>
                            <td>${item.B || "-"}</td>
                            <td>${item.D || "-"}</td>
                            <td>${item.E || "-"}</td>
                            <td class="activity-cell" id="activity-cell-${index}">
                                <div class="activity-text" id="activity-text-${index}" onclick="editActivity(${index}, '${
              item.id
            }')">
                                    ${
                                      item.atividade ||
                                      '<div class="placeholder-text"></div>'
                                    }
                                </div>
                                <button onclick="editActivity(${index}, '${
              item.id
            }')" class="activity-edit-btn">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </td>
                            <td class="criterio-cell">${item.F || "-"}</td>
                            <td class="date-cell">${formatDate(item.I)}</td>
                            <td class="date-cell">${formatDate(item.J)}</td>
                            <td><span class="status-badge status-${
                              status.status
                            }">${status.text}</span></td>
                            <td>
                                <button onclick="deleteObra('${
                                  item.id
                                }')" class="activity-edit-btn" title="Excluir">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        `;
            tableBody.appendChild(row);
          });
        }

        // Função para excluir uma obra
        function deleteObra(obraId) {
          if (confirm("Tem certeza que deseja excluir esta obra?")) {
            obrasData = obrasData.filter((item) => item.id !== obraId);
            renderTable(obrasData);
            applyFilters();
          }
        }

        // Aplicar filtros
        function applyFilters() {
          if (obrasData.length === 0) return;

          const dateFilter = document.getElementById("date-filter").value;
          const supervisorFilter =
            document.getElementById("supervisor-filter").value;
          const municipioFilter =
            document.getElementById("municipio-filter").value;
          const encarregadoFilter =
            document.getElementById("encarregado-filter").value;
          const searchText = document
            .getElementById("search")
            .value.toLowerCase();

          let filteredData = obrasData;

          if (supervisorFilter !== "all") {
            filteredData = filteredData.filter(
              (item) => item.B === supervisorFilter
            );
          }

          if (municipioFilter !== "all") {
            filteredData = filteredData.filter(
              (item) => item.E === municipioFilter
            );
          }

          if (encarregadoFilter !== "all") {
            filteredData = filteredData.filter(
              (item) => item.A === encarregadoFilter
            );
          }

          if (searchText) {
            filteredData = filteredData.filter((item) =>
              Object.values(item).some(
                (value) =>
                  value && value.toString().toLowerCase().includes(searchText)
              )
            );
          }

          if (dateFilter !== "all") {
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            filteredData = filteredData.filter((item) => {
              if (!item.I || !item.J) return false;

              const startDate = parseDate(item.I);
              const endDate = parseDate(item.J);

              if (!startDate || !endDate) return false;

              startDate.setHours(0, 0, 0, 0);
              endDate.setHours(0, 0, 0, 0);

              switch (dateFilter) {
                case "today":
                  return startDate <= today && endDate >= today;
                case "tomorrow":
                  const tomorrow = new Date(today);
                  tomorrow.setDate(tomorrow.getDate() + 1);
                  return startDate <= tomorrow && endDate >= tomorrow;
                case "week":
                  const nextWeek = new Date(today);
                  nextWeek.setDate(nextWeek.getDate() + 7);
                  return startDate <= nextWeek && endDate >= today;
                case "month":
                  const nextMonth = new Date(today);
                  nextMonth.setDate(nextMonth.getDate() + 30);
                  return startDate <= nextMonth && endDate >= today;
                default:
                  return true;
              }
            });
          }

          renderTable(filteredData);
        }

        function toggleSidebar() {
          const sidebar = document.getElementById("sidebar");
          const toggleIcon = document.querySelector(".sidebar-toggle i");

          sidebar.classList.toggle("collapsed");

          if (sidebar.classList.contains("collapsed")) {
            toggleIcon.classList.remove("fa-chevron-left");
            toggleIcon.classList.add("fa-chevron-right");
          } else {
            toggleIcon.classList.remove("fa-chevron-right");
            toggleIcon.classList.add("fa-chevron-left");
          }

          localStorage.setItem(
            "sidebarCollapsed",
            sidebar.classList.contains("collapsed")
          );
        }

        // Inicializar a sidebar com estado salvo
        document.addEventListener("DOMContentLoaded", function () {
          const sidebar = document.getElementById("sidebar");
          const isCollapsed =
            localStorage.getItem("sidebarCollapsed") === "true";

          if (isCollapsed) {
            sidebar.classList.add("collapsed");
            document
              .querySelector(".sidebar-toggle i")
              .classList.remove("fa-chevron-left");
            document
              .querySelector(".sidebar-toggle i")
              .classList.add("fa-chevron-right");
          }

          document
            .getElementById("sidebar-toggle")
            .addEventListener("click", toggleSidebar);

          // Carregar dados após o DOM estar pronto
          loadData();
        });

        // Exportar tabela para PNG ou JPEG
        function exportTable(format) {
          document.querySelectorAll(".activity-edit-btn").forEach((btn) => {
            btn.style.display = "none";
          });

          document.querySelectorAll(".date-cell").forEach((cell) => {
            cell.style.display = "none";
          });

          const tableHeaders = document.querySelectorAll("th");
          tableHeaders.forEach((header, index) => {
            if (
              header.textContent === "Início" ||
              header.textContent === "Término" ||
              header.textContent === "Ações"
            ) {
              header.style.display = "none";
            }
          });

          const exportElement = document.createElement("div");
          exportElement.style.backgroundColor = "#0E1117";
          exportElement.style.padding = "20px";
          exportElement.style.borderRadius = "10px";

          const headerClone = document.querySelector("header").cloneNode(true);
          exportElement.appendChild(headerClone);

          const tableClone = document
            .getElementById("table-to-export")
            .cloneNode(true);

          tableClone.querySelectorAll(".activity-edit-btn").forEach((btn) => {
            btn.style.display = "none";
          });

          tableClone.querySelectorAll(".date-cell").forEach((cell) => {
            cell.style.display = "none";
          });

          tableClone.querySelectorAll("td:nth-child(6)").forEach((cell) => {
            const atividadeDiv = cell.querySelector(".activity-text");
            if (atividadeDiv) {
              atividadeDiv.textContent = atividadeDiv.textContent.toUpperCase();
            } else {
              cell.textContent = cell.textContent.toUpperCase();
            }
          });

          tableClone.querySelectorAll("th").forEach((header, index) => {
            if (
              header.textContent === "Início" ||
              header.textContent === "Término" ||
              header.textContent === "Ações"
            ) {
              header.style.display = "none";
            }
          });

          exportElement.appendChild(tableClone);

          // Ocultar coluna de ações nas células
          tableClone.querySelectorAll("td:nth-child(11)").forEach((cell) => {
            cell.style.display = "none";
          });

          exportElement.appendChild(tableClone);

          // Adicionar ao documento temporariamente
          exportElement.style.position = "fixed";
          exportElement.style.left = "-9999px";
          document.body.appendChild(exportElement);

          // Capturar como imagem
          html2canvas(exportElement, {
            scale: 2,
            backgroundColor: "#0E1117",
          }).then((canvas) => {
            const link = document.createElement("a");
            link.download = `programacao-obras-nortetech.${format}`;
            link.href =
              format === "png"
                ? canvas.toDataURL("image/png")
                : canvas.toDataURL("image/jpeg", 0.9);
            link.click();

            // Remover o elemento temporário
            document.body.removeChild(exportElement);

            // Restaurar os botões de edição e datas na visualização
            document.querySelectorAll(".activity-edit-btn").forEach((btn) => {
              btn.style.display = "";
            });

            document.querySelectorAll(".date-cell").forEach((cell) => {
              cell.style.display = "";
            });

            // Restaurar cabeçalhos das colunas de data
            tableHeaders.forEach((header, index) => {
              if (
                header.textContent === "Início" ||
                header.textContent === "Término" ||
                header.textContent === "Ações"
              ) {
                header.style.display = "";
              }
            });

            // Restaurar coluna de ações
            document.querySelectorAll("td:nth-child(11)").forEach((cell) => {
              cell.style.display = "";
            });
          });
        }

        function exportTableWithDates(format) {
          // Primeiro, remover apenas os botões de edição da visualização atual
          document.querySelectorAll(".activity-edit-btn").forEach((btn) => {
            btn.style.display = "none";
          });

          // Ocultar cabeçalho da coluna de ações
          const tableHeaders = document.querySelectorAll("th");
          tableHeaders.forEach((header, index) => {
            if (header.textContent === "Ações") {
              header.style.display = "none";
            }
          });

          // Criar um elemento temporário para exportação
          const exportElement = document.createElement("div");
          exportElement.style.backgroundColor = "#0E1117";
          exportElement.style.padding = "20px";
          exportElement.style.borderRadius = "10px";

          // Clonar o header
          const headerClone = document.querySelector("header").cloneNode(true);
          exportElement.appendChild(headerClone);

          // Clonar a tabela
          const tableClone = document
            .getElementById("table-to-export")
            .cloneNode(true);

          // Remover apenas botões de edição do clone (mantendo as datas e status)
          tableClone.querySelectorAll(".activity-edit-btn").forEach((btn) => {
            btn.style.display = "none";
          });

          // Ocultar cabeçalho da coluna de ações no clone
          tableClone.querySelectorAll("th").forEach((header, index) => {
            if (header.textContent === "Ações") {
              header.style.display = "none";
            }
          });

          tableClone.querySelectorAll("td:nth-child(6)").forEach((cell) => {
            const atividadeDiv = cell.querySelector(".activity-text");
            if (atividadeDiv) {
              atividadeDiv.textContent = atividadeDiv.textContent.toUpperCase();
            } else {
              cell.textContent = cell.textContent.toUpperCase();
            }
          });

          // Ocultar coluna de ações nas células (ajustado para a 11ª coluna)
          tableClone.querySelectorAll("td:nth-child(11)").forEach((cell) => {
            cell.style.display = "none";
          });

          exportElement.appendChild(tableClone);

          // Adicionar ao documento temporariamente
          exportElement.style.position = "fixed";
          exportElement.style.left = "-9999px";
          document.body.appendChild(exportElement);

          // Capturar como imagem
          html2canvas(exportElement, {
            scale: 2,
            backgroundColor: "#0E1117",
          }).then((canvas) => {
            const link = document.createElement("a");
            link.download = `programacao-obras-nortetech-com-datas.${format}`;
            link.href =
              format === "png"
                ? canvas.toDataURL("image/png")
                : canvas.toDataURL("image/jpeg", 0.9);
            link.click();

            // Remover o elemento temporário
            document.body.removeChild(exportElement);

            // Restaurar os botões de edição na visualização
            document.querySelectorAll(".activity-edit-btn").forEach((btn) => {
              btn.style.display = "";
            });

            // Restaurar cabeçalho da coluna de ações
            tableHeaders.forEach((header, index) => {
              if (header.textContent === "Ações") {
                header.style.display = "";
              }
            });

            // Restaurar coluna de ações (ajustado para a 11ª coluna)
            document.querySelectorAll("td:nth-child(11)").forEach((cell) => {
              cell.style.display = "";
            });
          });
        }

        // Inicializar a aplicação
        function init() {
          // Atualizar data atual no header
          document.getElementById("current-date").textContent +=
            today.toLocaleDateString("pt-BR");

          // Carregar dados
          loadData();

          // Adicionar event listeners para exportação
          document
            .getElementById("export-png")
            .addEventListener("click", () => exportTable("png"));
          document
            .getElementById("export-jpeg")
            .addEventListener("click", () => exportTable("jpeg"));

          // Adicionar event listeners aos filtros
          document
            .getElementById("date-filter")
            .addEventListener("change", applyFilters);
          document
            .getElementById("supervisor-filter")
            .addEventListener("change", applyFilters);
          document
            .getElementById("encarregado-filter")
            .addEventListener("change", applyFilters);
          document
            .getElementById("municipio-filter")
            .addEventListener("change", applyFilters);
          document
            .getElementById("search")
            .addEventListener("input", applyFilters);
          document
            .getElementById("reset-filters")
            .addEventListener("click", () => {
              document.getElementById("date-filter").value = "today";
              document.getElementById("supervisor-filter").value = "all";
              document.getElementById("encarregado-filter").value = "all";
              document.getElementById("municipio-filter").value = "all";
              document.getElementById("search").value = "";
              applyFilters();
            });

          // Adicionar event listeners para a nova funcionalidade
          document.getElementById("new-obra").addEventListener("input", (e) => {
            autoFillFromObraCode(e.target.value);
          });

          document
            .getElementById("add-row-btn")
            .addEventListener("click", addNewObra);
          document
            .getElementById("clear-form-btn")
            .addEventListener("click", clearForm);
        }

        // Iniciar quando o documento estiver carregado
        document.addEventListener("DOMContentLoaded", init);

        // Função para exportar apenas o Quadro de Energização
        function exportEnergizacao() {
          const originalSection = document.getElementById("quadro-energizacao");
          const exportElement = originalSection.cloneNode(true);

          // Remover botões de ação do clone
          exportElement.querySelector(".form-actions").style.display = "none";

          // Estilizar para exportação
          exportElement.style.backgroundColor = "#0E1117";
          exportElement.style.padding = "20px";
          exportElement.style.borderRadius = "10px";
          exportElement.style.width = "800px";
          exportElement.style.margin = "0 auto";

          // Centralizar título na exportação
          const header = exportElement.querySelector(".section-header");
          header.style.justifyContent = "center";

          // Ajustar logo para exportação
          const logo = exportElement.querySelector(".energizacao-logo");
          if (logo) {
            logo.style.position = "absolute";
            logo.style.right = "20px";
          }

          // Adicionar ao documento temporariamente
          exportElement.style.position = "fixed";
          exportElement.style.left = "-9999px";
          exportElement.style.top = "0";
          document.body.appendChild(exportElement);

          // Capturar como imagem
          html2canvas(exportElement, {
            scale: 2,
            backgroundColor: "#0E1117",
            onclone: function (clonedDoc) {
              // Garantir que o título esteja centralizado no clone também
              const clonedHeader = clonedDoc.querySelector(".section-header");
              if (clonedHeader) {
                clonedHeader.style.justifyContent = "center";
              }
            },
          }).then((canvas) => {
            const link = document.createElement("a");
            link.download = "quadro-energizacao-nortetech.png";
            link.href = canvas.toDataURL("image/png");
            link.click();

            // Remover o elemento temporário
            document.body.removeChild(exportElement);
          });
        }

        // Função para limpar o formulário de energização
        function limparEnergizacao() {
          document
            .querySelectorAll(
              ".energizacao-form input, .energizacao-form textarea"
            )
            .forEach((input) => {
              input.value = "";
            });
        }

        // Função para salvar os dados do Quadro de Energização
        document.addEventListener("DOMContentLoaded", function () {
          // Elementos do DOM
          const obraSelect = document.getElementById("obra-select");
          const notification = document.getElementById("notification");

          // Mapeamento dos campos do formulário
          const fieldMap = {
            "energizacao-obra": "E",
            "energizacao-projeto-obra": "B",
            "energizacao-projeto-kit": "C",
            "energizacao-projeto-medidor": "D",
            "energizacao-municipio": "F",
            "energizacao-utd": "UTD", // Valor fixo
            "energizacao-plano": "L",
            "energizacao-criterio": "M",
            "energizacao-fiscal": "K",
            "energizacao-encarregado": "I",
            "energizacao-supervisor": "J",
            "energizacao-pes": "V",
            "energizacao-oc": "AO",
            "energizacao-data-pms": "AN",
            "energizacao-postes": "AG",
            "energizacao-clientes": "AC",
          };

          // Carregar o arquivo JSON
          fetch("obras.json")
            .then((response) => {
              if (!response.ok) {
                throw new Error("Erro ao carregar o arquivo JSON");
              }
              return response.json();
            })
            .then((data) => {
              // Verificar se há obras com data na coluna AL
              const obrasComData = data.filter(
                (obra) => obra.AN && obra.AN.trim() !== ""
              );

              if (obrasComData.length === 0) {
                notification.style.display = "block";
                notification.textContent =
                  "Nenhuma obra com data de energização encontrada no arquivo JSON.";
                return;
              }

              // Preencher o dropdown com as obras que têm data na coluna AL
              obrasComData.forEach((obra) => {
                const option = document.createElement("option");
                option.value = obra.E; // Usar o nome da obra como valor
                option.textContent = `${obra.E} (${obra.AN})`;
                option.dataset.obra = JSON.stringify(obra);
                obraSelect.appendChild(option);
              });

              // Adicionar evento de change ao dropdown
              obraSelect.addEventListener("change", function () {
                if (this.value) {
                  const selectedObra = JSON.parse(
                    this.options[this.selectedIndex].dataset.obra
                  );
                  preencherFormulario(selectedObra);
                } else {
                  limparFormulario();
                }
              });
            })
            .catch((error) => {
              console.error("Erro:", error);
              notification.style.display = "block";
              notification.textContent =
                "Erro ao carregar os dados. Verifique se o arquivo obras.json está na mesma pasta.";
            });

          // Função para preencher o formulário com os dados da obra
          function preencherFormulario(obra) {
            for (const [fieldId, jsonKey] of Object.entries(fieldMap)) {
              const field = document.getElementById(fieldId);

              if (jsonKey === "UTD") {
                // Valor fixo para UTD
                field.value = "IRECÊ";
              } else if (jsonKey === "AN" && obra[jsonKey]) {
                // Formatar data para o input type="date" (YYYY-MM-DD)
                const dateParts = obra[jsonKey].split("/");
                if (dateParts.length === 3) {
                  field.value = `${dateParts[2]}-${dateParts[1].padStart(
                    2,
                    "0"
                  )}-${dateParts[0].padStart(2, "0")}`;
                } else {
                  field.value = obra[jsonKey] || "";
                }
              } else {
                field.value = obra[jsonKey] || "";
              }
            }
          }

          // Função para limpar o formulário
          function limparFormulario() {
            for (const fieldId of Object.keys(fieldMap)) {
              document.getElementById(fieldId).value = "";
            }
            document.getElementById("energizacao-perdas").value = "";
            document.getElementById("energizacao-obs").value = "";
          }

          // Função para exportar apenas o Quadro de Energização
          function exportEnergizacao() {
            const originalSection =
              document.getElementById("quadro-energizacao");
            const exportElement = originalSection.cloneNode(true);

            // Remover elementos não necessários na exportação
            exportElement.querySelector(".data-selector").remove();
            exportElement.querySelector("#notification").remove();

            // Remover botões de ação do clone
            exportElement.querySelector(".form-actions").style.display = "none";

            // Estilizar para exportação
            exportElement.style.backgroundColor = "#0E1117";
            exportElement.style.padding = "20px";
            exportElement.style.borderRadius = "10px";
            exportElement.style.width = "800px";
            exportElement.style.margin = "0 auto";

            // Centralizar título na exportação
            const header = exportElement.querySelector(".section-header");
            header.style.justifyContent = "center";

            // Ajustar logo para exportação
            const logo = exportElement.querySelector(".energizacao-logo");
            if (logo) {
              logo.style.position = "absolute";
              logo.style.right = "20px";
            }

            // Adicionar ao documento temporariamente
            exportElement.style.position = "fixed";
            exportElement.style.left = "-9999px";
            exportElement.style.top = "0";
            document.body.appendChild(exportElement);

            // Capturar como imagem
            html2canvas(exportElement, {
              scale: 2,
              backgroundColor: "#0E1117",
              onclone: function (clonedDoc) {
                // Garantir que o título esteja centralizado no clone também
                const clonedHeader = clonedDoc.querySelector(".section-header");
                if (clonedHeader) {
                  clonedHeader.style.justifyContent = "center";
                }
              },
            }).then((canvas) => {
              const link = document.createElement("a");
              link.download = "quadro-energizacao-nortetech.png";
              link.href = canvas.toDataURL("image/png");
              link.click();

              // Remover o elemento temporário
              document.body.removeChild(exportElement);
            });
          }

          // Função para salvar os dados do Quadro de Energização
          function salvarEnergizacao() {
            const dados = {
              obra: document.getElementById("energizacao-obra").value,
              projetoObra: document.getElementById("energizacao-projeto-obra")
                .value,
              projetoKit: document.getElementById("energizacao-projeto-kit")
                .value,
              projetoMedidor: document.getElementById(
                "energizacao-projeto-medidor"
              ).value,
              municipio: document.getElementById("energizacao-municipio").value,
              utd: document.getElementById("energizacao-utd").value,
              plano: document.getElementById("energizacao-plano").value,
              criterio: document.getElementById("energizacao-criterio").value,
              fiscal: document.getElementById("energizacao-fiscal").value,
              encarregado: document.getElementById("energizacao-encarregado")
                .value,
              supervisor: document.getElementById("energizacao-supervisor")
                .value,
              pes: document.getElementById("energizacao-pes").value,
              oc: document.getElementById("energizacao-oc").value,
              dataPms: document.getElementById("energizacao-data-pms").value,
              postes: document.getElementById("energizacao-postes").value,
              clientes: document.getElementById("energizacao-clientes").value,
              perdas: document.getElementById("energizacao-perdas").value,
              obs: document.getElementById("energizacao-obs").value,
            };

            // Salvar no localStorage
            localStorage.setItem("quadroEnergizacao", JSON.stringify(dados));

            alert("Quadro de Energização salvo com sucesso!");
          }

          // Event listeners para os botões
          document
            .getElementById("limpar-energizacao")
            .addEventListener("click", function () {
              limparFormulario();
              obraSelect.value = "";
            });

          document
            .getElementById("salvar-energizacao")
            .addEventListener("click", salvarEnergizacao);

          document
            .getElementById("export-energizacao")
            .addEventListener("click", exportEnergizacao);
        });
      </script>
    </body>
  </body>
</html>
